<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalibracja Systemu</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .calibration-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 600px;
            width: 90%;
        }

        .title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: #ffffff;
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 40px;
            opacity: 0.9;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .progress-container {
            margin: 30px 0;
            position: relative;
        }

        .progress-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring__circle {
            transition: stroke-dasharray 0.1s;
            fill: transparent;
            stroke-width: 8;
        }

        .progress-ring__background {
            stroke: rgba(255, 255, 255, 0.2);
        }

        .progress-ring__progress {
            stroke: #10b981;
            stroke-linecap: round;
            filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.5));
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .status-text {
            font-size: 24px;
            margin: 20px 0;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .steps-list {
            margin-top: 30px;
            text-align: left;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 16px;
            transition: all 0.3s;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }

        .step.pending {
            opacity: 0.5;
        }

        .step.pending .step-icon {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .step.active {
            opacity: 1;
            color: #10b981;
        }

        .step.active .step-icon {
            background: #10b981;
            color: white;
            animation: pulse 2s infinite;
        }

        .step.completed {
            opacity: 1;
        }

        .step.completed .step-icon {
            background: #10b981;
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .completion-message {
            display: none;
            font-size: 24px;
            color: #10b981;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }

        .device-info {
            margin-top: 30px;
            font-size: 14px;
            opacity: 0.8;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="calibration-container">
        <div class="title">⚙️ KALIBRACJA SYSTEMU</div>
        <div class="subtitle">Inicjalizacja i kalibracja komponentów systemu...</div>
        
        <div class="progress-container">
            <div class="progress-circle">
                <svg width="200" height="200" class="progress-ring">
                    <circle class="progress-ring__circle progress-ring__background" 
                            cx="100" cy="100" r="90" />
                    <circle class="progress-ring__circle progress-ring__progress" 
                            cx="100" cy="100" r="90" 
                            stroke-dasharray="565.48" 
                            stroke-dashoffset="565.48" 
                            id="progress" />
                </svg>
                <div class="progress-text" id="timer">10</div>
            </div>
        </div>

        <div class="status-text" id="status">Przygotowywanie systemu...</div>

        <div class="steps-list">
            <div class="step" id="step1">
                <div class="step-icon">1</div>
                <div>Inicjalizacja sensorów ciśnienia</div>
            </div>
            <div class="step" id="step2">
                <div class="step-icon">2</div>
                <div>Kalibracja układu pneumatycznego</div>
            </div>
            <div class="step" id="step3">
                <div class="step-icon">3</div>
                <div>Test komunikacji z modułami</div>
            </div>
            <div class="step" id="step4">
                <div class="step-icon">4</div>
                <div>Weryfikacja parametrów bezpieczeństwa</div>
            </div>
            <div class="step" id="step5">
                <div class="step-icon">5</div>
                <div>Finalizacja konfiguracji</div>
            </div>
        </div>

        <div class="completion-message" id="completion">
            ✅ KALIBRACJA ZAKOŃCZONA POMYŚLNIE
        </div>

        <div class="device-info">
            <strong>CONNECT 500</strong> | MASKTRONIC C20 v2.1.0<br>
            Czas kalibracji: 10 sekund | Status: W trakcie...
        </div>
    </div>

    <script>
        let timeLeft = 10;
        let currentStep = 0;
        const totalSteps = 5;
        const circumference = 2 * Math.PI * 90; // r=90
        
        const timerDisplay = document.getElementById('timer');
        const statusDisplay = document.getElementById('status');
        const progressCircle = document.getElementById('progress');
        const completionMessage = document.getElementById('completion');
        
        const steps = [
            { id: 'step1', message: 'Inicjalizacja sensorów ciśnienia...', duration: 2 },
            { id: 'step2', message: 'Kalibracja układu pneumatycznego...', duration: 2 },
            { id: 'step3', message: 'Test komunikacji z modułami...', duration: 2 },
            { id: 'step4', message: 'Weryfikacja parametrów bezpieczeństwa...', duration: 2 },
            { id: 'step5', message: 'Finalizacja konfiguracji...', duration: 2 }
        ];

        // Set initial progress circle
        progressCircle.style.strokeDasharray = circumference;
        progressCircle.style.strokeDashoffset = circumference;

        function updateProgress() {
            const progress = ((10 - timeLeft) / 10) * circumference;
            progressCircle.style.strokeDashoffset = circumference - progress;
        }

        function updateStep() {
            const stepIndex = Math.floor((10 - timeLeft) / 2);
            
            if (stepIndex < steps.length && stepIndex !== currentStep) {
                // Complete previous step
                if (currentStep > 0) {
                    const prevStep = document.getElementById(steps[currentStep - 1].id);
                    prevStep.classList.remove('active');
                    prevStep.classList.add('completed');
                    prevStep.querySelector('.step-icon').textContent = '✓';
                }
                
                // Activate current step
                const currentStepEl = document.getElementById(steps[stepIndex].id);
                currentStepEl.classList.remove('pending');
                currentStepEl.classList.add('active');
                
                statusDisplay.textContent = steps[stepIndex].message;
                currentStep = stepIndex + 1;
            }
        }

        function startCalibration() {
            // Mark all steps as pending initially
            steps.forEach(step => {
                document.getElementById(step.id).classList.add('pending');
            });

            const countdown = setInterval(() => {
                updateProgress();
                updateStep();
                
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    
                    // Complete final step
                    const lastStep = document.getElementById(steps[steps.length - 1].id);
                    lastStep.classList.remove('active');
                    lastStep.classList.add('completed');
                    lastStep.querySelector('.step-icon').textContent = '✓';
                    
                    // Show completion
                    statusDisplay.textContent = 'Kalibracja zakończona pomyślnie!';
                    completionMessage.style.display = 'block';
                    timerDisplay.textContent = '✓';
                    timerDisplay.style.color = '#10b981';
                    
                    // Notify parent window
                    setTimeout(() => {
                        window.parent.postMessage({
                            type: 'calibration_complete',
                            success: true
                        }, '*');
                    }, 2000);
                    
                } else {
                    timerDisplay.textContent = timeLeft;
                    timeLeft--;
                }
            }, 1000);
        }

        // Start calibration when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(startCalibration, 500);
        });
    </script>
</body>
</html>
